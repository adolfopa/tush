#!/bin/sh
# Copyright 2007 Darius Bacon under the MIT X license.

# Checking succeeds iff each script produces itself unaltered as output.

usage()
{
    echo "usage: $(basename $0) -h"
    echo "       $(basename $0) [<tush-script> ...]"

}

while getopts h opt; do
    case $opt in
	h) usage && exit ;;
	?) usage >&2 && exit 64 ;;
    esac
done

output=$(mktemp tush-output.XXXXX)

cleanup()
{
    rm -f $output
}

trap cleanup EXIT HUP KILL TERM

for f in "$@"
do
    (tush-run ${f} >$output && diff -b -u ${f} $output) || exit 1
done
